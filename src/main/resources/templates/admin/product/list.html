<html xmlns:th="http://www.thymeleaf.org">

<html lang="en">

<script>


    window.onload = function (){
        const selectAllCheckbox = document.getElementsByName('allcheckbox')[0];
        const checkBoxes = document.getElementsByName('checkbox');
        const deleteSelctedLink = document.getElementById('deleteSelected');

        selectAllCheckbox.addEventListener('change', function () {
            for (let i = 0; i < checkBoxes.length; i++) {
                checkBoxes[i].checked = selectAllCheckbox.checked;
            }
        });

        //선택삭제 링크 클릭 이벤트 처리
        deleteSelctedLink.addEventListener('click',function (event){
            event.preventDefault(); // 링크 기본 동작 중단
            const selectedCheckboxes = [];
            checkBoxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    selectedCheckboxes.push(checkbox.value);
                }
            });

            // 선택된 체크박스의 값을 서버로 전송하는 코드 작성
            fetch('/delete-selected-items', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(selectedCheckboxes)
            }).then(response => {
                if (response.ok) {
                    // 성공적으로 처리된 경우
                } else {
                    // 오류 처리
                }
            }).catch(error => {
                console.error('Error:', error);
            });
        });
    };

</script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>팜스토리</title>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/bxslider/4.2.12/jquery.bxslider.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/admin/css/style.css}">
    <style>
        #adminProdList .admProdImg1{
            max-width: 120px;
            max-height: 120px;
        }
        th, td {
            text-align: center;
        }
    </style>
</head>

<body>
    <div id="container">
        <header>
            <a th:href="@{/admin}" class="logo"><img th:src="@{/images/admin/images/admin_logo.jpg}" alt="로고"/></a>
            <p>
                <a th:href="@{/}">HOME |</a>
                <a th:href="@{/user/logout}">로그아웃 |</a>
                <a href="#">고객센터</a>
            </p>
        </header>
        <main>
            <aside>
                <h3>주요기능</h3>
                <ul>
                    <li class="on"><a th:href="@{/admin/user/list}">회원관리</a></li>
                    <li><a th:href="@{/admin/product/list}">상품관리</a></li>
                    <li><a th:href="@{/admin/order/list}">주문관리</a></li>
                </ul>
            </aside>
            <section id="productList">
                <nav>
                    <h3>상품목록</h3>
                </nav>

                <article>

                    <table id="adminProdList" border="0">
                        <tr>
                            <th><input type="checkbox" name="allcheckbox"/></th>
                            <th>사진</th>
                            <th>상품번호</th>
                            <th>상품명</th>
                            <th>구분</th>
                            <th>가격</th>
                            <th>재고</th>
                            <th>등록일</th>
                        </tr>

                        <tr th:each="product: ${adminProducts}">
                            <td><input type="checkbox" name=""/></td>
                            <td><img class="admProdImg1" th:src="@{|/product/${product.cate}/${product.img1}|}" alt="썸네일"></td>

                            <td>[[${product.pno}]]</td>
                            <td>[[${product.pname}]]</td>
                            <td>[[${product.cate}]]</td>
                            <td>[[${product.price}]]</td>
                            <td>[[${product.stock}]]</td>
                            <td th:text="${#temporals.format(product.rdate, 'yyyy-MM-dd')}"></td>

                        </tr>
                    </table>

                    <p>
                        <a href="#" class="productDelete">선택삭제</a>
                        <a th:href="@{/admin/product/register}" class="productRegister">상품등록</a>

                    </p>

                    <!-- 페이지네이션 -->
                    <nav aria-label="...">
                        <ul class="pagination justify-content-center">
                            <li th:if="${!adminProductPage.isIsFirstPage()}" class="page-item">
                                <a class="page-link" th:href="@{/admin/product/list(pageNum=${adminProductPage.pageNum} - 1)}">이전</a>
                            </li>
                            <!-- 현재 페이지 번호와의 차이가 10 이하일 때까지만 페이지 번호를 출력합니다 -->
                            <li th:each="num : ${#numbers.sequence(adminProductPage.navigateFirstPage, adminProductPage.navigateLastPage)}"
                                th:classappend="${num == adminProductPage.pageNum} ? 'active' : ''"
                                class="page-item">
                                <a class="page-link" th:href="@{/admin/product/list(pageNum=${num})}" th:text="${num}"></a>
                            </li>
                            <li th:if="${adminProductPage.hasNextPage}" class="page-item">
                                <a class="page-link" th:href="@{/admin/product/list(pageNum=${adminProductPage.pageNum} + 1)}">다음</a>
                            </li>
                        </ul>
                    </nav>

                </article>

                
            </section>
        </main>
        <footer>
            <p>
                Copyright(C)Farmstory All rights reserved. FARMSTORY ADMINISTRATOR Version 1.0.2
            </p>
        </footer>
    </div>
    
</body>
</html>