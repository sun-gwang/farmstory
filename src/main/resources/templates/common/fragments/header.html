<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:fragment="HeaderFragment">
<div id="container">
    <header>
        <script>
            window.onload = function () {
                checkLoginStatus();
                const mypageLink = document.getElementById('mypageLink');
                const cartLink = document.getElementById('cartLink');
                const deliveryLink = document.getElementById('deliveryLink');

                // 로그인한 경우에만 링크 활성화
                if (checkLoginStatus) {
                    mypageLink.onclick = function () {
                        return true;
                    };
                    cartLink.onclick = function () {
                        return true;
                    };
                    deliveryLink.onclick = function () {
                        return true;
                    };
                } else {
                    // 로그인 하지 않은 경우 링크 비활성화
                    mypageLink.onclick = function () {
                        return false
                    };
                    cartLink.onclick = function () {
                        return false
                    };
                    deliveryLink.onclick = function () {
                        return false
                    };
                }

                function checkLoginStatus() {
                    fetch('/checkLogin')
                        .then(response => {
                            if (response.ok) {
                                // 사용자가 로그인되어 있는 경우
                                console.log('사용자는 로그인되어 있습니다.');
                            } else {
                                // 사용자가 로그인되어 있지 않은 경우
                                console.log('사용자는 로그인되어 있지 않습니다.');
                            }
                        })
                        .catch(error => {
                            console.error('로그인 상태를 확인하는 중 오류가 발생했습니다.', error);
                        });
                }
            };
        </script>
        <p class="top_nav">
            <a th:href="@{/}">HOME |</a>
            <a sec:authorize="isAnonymous()" th:href="@{/user/terms}">회원가입 |</a>
            <a sec:authorize="isAnonymous()" th:href="@{/user/login}">로그인 |</a>
            <a sec:authorize="isAuthenticated()" th:href="@{/user/modify(uid=${#authentication.principal.user.uid})}">[[${#authentication.principal.user.nick}]] |</a>
            <a sec:authorize="isAuthenticated()" th:href="@{/admin}">관리자 |</a>
            <a sec:authorize="isAuthenticated()" th:href="@{/user/logout}">로그아웃 |</a>
            <a href="#">고객센터</a>
        </p>
        <div class="middle_nav">
            <a th:href="@{/}" class="logo"><img th:src="@{/images/logo.png}" alt="로고"/></a>
            <form th:action="@{/market/list}" method="get">
                <div class="searchBox">
                    <input type="search" id="hd_search" name="keyword" placeholder="상품을 검색하세요.">
                    <button class="searchBtn">
                        <img th:src="@{/images/header/search_40.png}" alt="검색">
                    </button>
                </div>
            </form>
            <div class="rightNav">
                <a id="mypageLink" sec:authorize="isAuthenticated()" th:href="@{/user/modify(uid=${#authentication.principal.user.uid})}">
                    <img th:src="@{/images/header/user_50.png}" alt="마이페이지">
                </a>
                <a id="cartLink" sec:authorize="isAuthenticated()" th:href="@{/market/cart(uid=${#authentication.principal.user.uid})}">
                    <img th:src="@{/images/header/head_cart.gif}" alt="장바구니">
                </a>
                <a id="deliveryLink" href="#">
                    <img th:src="@{/images/header/delivery.gif}" alt="배송">
                </a>
            </div>
        </div>

        <!--<img th:src="@{/images/head_txt_img.png}" alt="3만원 이상 무료배송"/>-->

        <ul class="gnb">
            <li><a th:href="@{/introduction/hello}">팜스토리소개</a></li>
            <li><a th:href="@{/market/list}"><img th:src="@{/images/head_menu_badge.png}" alt="30%"/>장바구니</a></li>
            <li><a th:href="@{/article/list(grp='croptalk',cate='story')}">농작물이야기</a></li>
            <li><a th:href="@{/article/list(grp='event',cate='event')}">이벤트</a></li>
            <li><a th:href="@{/article/list(grp='community',cate='notice')}">커뮤니티</a></li>
        </ul>
    </header>
</html>